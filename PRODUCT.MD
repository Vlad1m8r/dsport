# PRODUCT — Telegram WebApp «Workout Journal»
## MVP v2 (Templates-first)

---

## 1. Цель продукта
Telegram Mini App для людей, занимающихся в зале, которая позволяет:
- заранее готовить **шаблоны тренировок**,
- в зале **быстро фиксировать фактические данные** (вес, повторы, время),
- видеть историю и базовый прогресс по упражнениям.

Основной принцип MVP:
> **План и факт разделены.  
Шаблон — это план.  
Тренировка — это факт.**

---

## 2. Платформа и окружение
- Клиент: Telegram Mini App (WebView).
- Идентификация пользователя: Telegram WebApp `initData`.
- Архитектура: 3 сервиса
    - Frontend (Vite + React)
    - Backend (Spring Boot)
    - Database (PostgreSQL)

---

## 3. Ключевые пользовательские сценарии (User Cases)

### UC-1: Создание шаблона тренировки
**Цель:** подготовить тренировку заранее, не в зале.

**Флоу:**
1. Пользователь нажимает «Создать шаблон».
2. Вводит название (например: `Грудь`).
3. Добавляет упражнения:
    - из системных,
    - или из своих.
4. Для каждого упражнения задаёт план:
    - количество подходов,
    - планируемые повторы **или** время.
    - вес не указывается.
5. Сохраняет шаблон.

**Примечания:**
- Шаблон — это план, он не содержит фактических данных.
- Шаблон можно редактировать и удалять.
- В MVP — только пользовательские шаблоны (системные позже).

---

### UC-2: Начать тренировку по шаблону
**Цель:** быстро начать тренировку в зале.

**Флоу:**
1. Пользователь нажимает «Начать тренировку».
2. Выбирает шаблон.
3. Создаётся новая тренировка (WorkoutSession):
    - название: `ДД.ММ.ГГГГ + название шаблона`,
    - сохраняется ссылка на шаблон.
4. Все упражнения и подходы из шаблона копируются в тренировку.
5. Пользователь:
    - заполняет фактические веса и повторы,
    - при необходимости добавляет или удаляет подходы,
    - может добавить или удалить упражнение.

**UX-дополнение:**
- При открытии упражнения показывается:
    - максимальный вес / время из **последней тренировки** с этим упражнением.

---

### UC-3: Начать тренировку без шаблона
**Цель:** гибкость.

**Флоу:**
1. Пользователь нажимает «Начать тренировку».
2. Пропускает выбор шаблона.
3. Создаётся пустая тренировка:
    - название: `ДД.ММ.ГГГГ`.
4. Пользователь вручную добавляет упражнения:
    - из системных,
    - или из своих.
5. Добавляет подходы и заполняет данные.

---

### UC-4: Просмотр истории тренировок
- Пользователь видит список тренировок (по дате).
- Может открыть тренировку и посмотреть:
    - упражнения,
    - подходы,
    - веса / повторы / время.

---

### UC-5: Фильтрация упражнений
- Упражнения имеют группы мышц.
- Пользователь может фильтровать упражнения по группам мышц при выборе.

---

## 4. Out of Scope (не входит в MVP)
- Системные шаблоны тренировок.
- Тренеры, друзья, социальные функции.
- AI-рекомендации тренировок, весов, диет.
- Лента статей, рецепты, меню.
- Подписки, платежи.
- Продвинутая аналитика по группам мышц.

---

## 5. Доменные сущности (MVP)

### User
- Представляет Telegram-пользователя.
- Идентификация через `tgUserId`.

---

### Exercise
Справочник упражнений.

Поля:
- `id`
- `name`
- `type` (REPS_WEIGHT | TIME)
- `ownerUserId` (null = системное)
- `createdAt`
- `updatedAt`

Связи:
- Exercise ↔ MuscleGroup (many-to-many)

---

### MuscleGroup
Справочник групп мышц.

Примеры:
- CHEST
- BACK
- LEGS
- SHOULDERS
- ARMS
- CORE

---

### WorkoutTemplate
Шаблон тренировки (план).

Поля:
- `id`
- `name`
- `ownerUserId`
- `createdAt`
- `updatedAt`

Связи:
- WorkoutTemplate → TemplateExercise (1 → N)

---

### TemplateExercise
Упражнение внутри шаблона.

Поля:
- `id`
- `templateId`
- `exerciseId`
- `orderIndex`

Связи:
- TemplateExercise → TemplateSet (1 → N)

---

### TemplateSet
Плановый подход.

Поля:
- `id`
- `templateExerciseId`
- `plannedReps` (nullable)
- `plannedDurationSeconds` (nullable)
- `orderIndex`

---

### WorkoutSession
Фактическая тренировка пользователя.

Поля:
- `id`
- `userId`
- `templateId` (nullable)
- `title`
- `startedAt`
- `createdAt`
- `updatedAt`

Связи:
- WorkoutSession → WorkoutExercise (1 → N)

---

### WorkoutExercise
Упражнение внутри тренировки.

Поля:
- `id`
- `workoutSessionId`
- `exerciseId`
- `orderIndex`

Связи:
- WorkoutExercise → SetEntry (1 → N)

---

### SetEntry
Фактический подход.

Поля:
- `id`
- `workoutExerciseId`
- `reps` (nullable)
- `weight` (nullable, кг)
- `durationSeconds` (nullable)
- `orderIndex`

---

## 6. Правила данных
- Все сущности имеют `createdAt`, `updatedAt`.
- Пользователь видит только свои данные + системные упражнения.
- Вес в шаблонах не хранится.
- При старте тренировки из шаблона:
    - TemplateSet копируется в SetEntry.
- Упражнения можно удалять из активной тренировки (шаблон не меняется).

---

## 7. API и интеграция
- REST API, JSON, camelCase.
- Каждый запрос с клиента содержит Telegram `initData`.
- Backend валидирует `initData` и определяет пользователя.
- Все эндпоинты и DTO документируются через OpenAPI.

---

## 8. Нефункциональные требования (MVP)
- Минимум действий в зале.
- Быстрый рендер внутри Telegram WebView.
- Все изменения схемы БД — только через Flyway.
- Код должен быть понятен для автогенерации (Codex).

---

## 9. Дальнейшее развитие (vNext, не MVP)

### Phase 2
- Системные шаблоны.
- Профиль пользователя (вес, рост, возраст).
- Продвинутый прогресс по упражнениям.
- PR / all-time max.

### Phase 3
- Тренеры и клиенты.
- План тренировок от тренера.
- Аналитика по группам мышц.

### Phase 4
- AI-рекомендации.
- Диеты и питание.
